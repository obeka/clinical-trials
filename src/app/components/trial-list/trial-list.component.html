<div *ngIf="loading()">Loading trials...</div>
<div *ngIf="error()" class="error">{{ error() }}</div>
<div *ngIf="!loading() && trials().length === 0">No trials found.</div>

<button
  mat-raised-button
  color="accent"
  (click)="addToFavorites()"
  [disabled]="selected().size === 0"
  style="margin-bottom: 1rem"
>
  Add to Favorites
</button>

<p style="margin: 1rem 0; font-weight: bold">
  ‚è≥ Next update in: {{ countdown() }}s
</p>

<mat-card *ngFor="let trial of trials()" class="trial-card">
  <mat-card-title style="display: flex; align-items: center; gap: 0.5rem">
    <mat-checkbox
      (change)="
        toggleSelection(
          trial.protocolSection?.identificationModule?.nctId ?? ''
        )
      "
      [checked]="
        selected().has(trial.protocolSection?.identificationModule?.nctId ?? '')
      "
    ></mat-checkbox>
    {{
      trial.protocolSection?.identificationModule?.briefTitle ||
        "No title available"
    }}
  </mat-card-title>

  <mat-card-content>
    <p>
      <strong>NCT ID:</strong>
      {{ trial.protocolSection?.identificationModule?.nctId }}
    </p>
    <p>
      <strong>Status:</strong>
      {{ trial.protocolSection?.statusModule?.overallStatus }}
    </p>
    <p>
      <strong>Conditions:</strong>
      {{
        trial.protocolSection?.conditionsModule?.conditions?.join(", ") || "N/A"
      }}
    </p>
    <p>
      <strong>Phase:</strong>
      {{ trial.protocolSection?.designModule?.phases?.join(", ") || "N/A" }}
    </p>
    <p>
      <strong>Sponsor:</strong>
      {{
        trial.protocolSection?.sponsorCollaboratorsModule?.leadSponsor?.name ||
          "N/A"
      }}
    </p>
    <p>
      <strong>Start Date:</strong>
      {{ trial.protocolSection?.statusModule?.startDateStruct?.date || "N/A" }}
    </p>
  </mat-card-content>
</mat-card>
